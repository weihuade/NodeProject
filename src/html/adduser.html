<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>添加用户</title>
<link rel="stylesheet" href="../css/base.css">
<link rel="stylesheet" href="../assets/bootstrap-4.0.0/dist/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="../css/adduser.css"/>
<script type="text/javascript" src="js/common.js"></script>
<script src="../assets/jquery-3.2.1.js"></script>
<script src="../assets/bootstrap-4.0.0/dist/js/bootstrap.js"></script>

</head>
<body>
	
 <!-- 左边的侧边栏 -->
    <div class="aside fl">
        <!-- 侧边栏标题 -->
        <div class="title">
            <img src="../assets/images/goodslist/logo.png">
            <span>后台管理系统</span>
        </div>
        <!-- 侧边栏菜单 -->
        <div class="menu">
            <div id="accordion">
                <div class="card">
                    <div class="card-header hover" id="headingOne">
                        <h5 class="mb-0">
                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                商品管理
                            </button>
                        </h5>
                    </div>
                
                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">
                            <ul>
                                <a href="./goodslist.html"><li class="hover">商品列表</li></a>
                                <a href="./goodscategory.html"> <li class="hover">商品分类</li></a>
                                <a href="./goodsadd.html"><li class="hover">添加商品</li></a>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header hover" id="headingTwo">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                用户管理
                            </button>
                        </h5>
                    </div>
                    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body">
                            <ul>
                                <a href="./userslist.html"><li class="hover">用户列表</li></a>
                                <a href="./adduser.html"><li class="hover">添加用户</li></a>
                            </ul>
                    </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header hover" id="headingThree">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                订单管理
                            </button>
                        </h5>
                    </div>
                    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                        <div class="card-body">
                            <ul>
                                <li class="hover">订单列表</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



  <!-- 右边的主体部分 -->
    <div class="main fl">
        <!-- 导航头部 -->
        <div class="m_head">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">首页</a></li>
                    <li class="breadcrumb-item"><a href="#">用户管理</a></li>
                    <li class="breadcrumb-item active" aria-current="page">
                        <a href="#">添加用户</a>
                    </li>
                    
                </ol>
                <a href="#" class="fr">退出</a>
            </nav>
        <img  class="white" src="img/u66.png">
        </div>
        <!-- 主体内容 -->
        <div class="m_body">
            <div class="contain">
           <form>
  <div class="usernicheng">
    <div class="form-group col-md-6">
      <label for="inputEmail4">用户名</label>
      <input type="text" class="form-control username" id="inputEmail4" placeholder="请输入用户名">
      <span class="username2"></span>
      
    </div>
    <div class="form-group col-md-6">
      <label for="inputPassword4">昵称</label>
      <input type="text" class="form-control nicheng" id="inputPassword4" placeholder="请输入昵称">
        <span class="nicheng2"></span>
    </div>
  </div>
  <div class="form-group pass">
    <label for="inputAddress">密码</label>
    <input type="password" class="form-control password" id="inputAddress" placeholder="请输入密码">
     <span class="password2"></span>
  </div>
  <div class="form-group repass">
    <label for="inputAddress2">确认密码</label>
    <input type="password" class="form-control repassword" id="inputAddress2" placeholder="确认密码">
     <span class="repassword2"></span>
  </div>
  <div class="form-row phonesex">
    <div class="form-group col-md-2">
      <label for="inputZip">手机号</label>
      <input type="text" class="form-control phone" id="inputZip">
        <p class="phone2"></p>
    </div>
   <div class="form-group col-md-4">
      <label for="inputState">性别</label>
      <select id="inputState" class="form-control sex">
        <option selected>请选择</option>
       <option >男</option>
        <option>女</option>
        <option>其他</option>
      </select>
    </div>
   
  </div>
  <div class="form-group email1">
    <label for="exampleFormControlInput1">邮箱地址</label>
    <input type="email" class="form-control email" id="exampleFormControlInput1" placeholder="请输入邮箱地址">
    <span class="email2"></span>
  </div>
  <div class="form-group beizhu1">
    <label for="exampleFormControlTextarea1">备注</label>
    <textarea class="form-control beizhu" id="exampleFormControlTextarea1" rows="3"></textarea>
  </div>
  <button type="button" class="btn btn-primary btninsert">确认</button>
  <span class="hint"></span>
  	
  
</form>
           
            </div>
        </div>
    </div>

</body>
</html>
<script type="text/javascript">
	
	//用户名的正则验证
	let username=document.querySelector('.username')
	let username2=document.querySelector('.username2')
	username.onkeyup=function(){
			let val=username.value.trim();
			if(val){
				//非空
				if(checkReg.chinese(val)){
					username2.innerHTML='用户名格式正确';
					username2.style.color='green';
					
				}else{
					username2.innerHTML='用户名格式不正确';
					username2.style.color='red';
				}
			}
		}
	
	//密码和确认密码是否相等
	let  password=document.querySelector('.password');
	let  repassword=document.querySelector('.repassword');
	let  repassword2=document.querySelector('.repassword2');
	repassword.onkeyup=()=>{
	let pass=password.value.trim();
	let repass=repassword.value.trim();
	if(pass&&repass){
		
		if(repass==pass){
		repassword2.innerHTML='输入的密码一致';
		repassword2.style.color='green';
		}else{
		repassword2.innerHTML='输入的密码不一致';
		repassword2.style.color='red';
			}
		}else{
		repassword2.innerHTML='密码不能为空';
		repassword2.style.color='red';
		}
	}
	
	
	//手机号正则
	let phone=document.querySelector('.phone');
	let phone2=document.querySelector('.phone2');
	
	phone.onkeyup=function(){
			var val=phone.value.trim();
			if(val){
				//非空
				if(checkReg.tel(val)){
					phone2.innerHTML='手机号码格式正确';
					phone2.style.color='green';
					
				}else{
					phone2.innerHTML='手机号码不正确';
					phone2.style.color='red';
				}
			}
		}
	
	//邮箱正则
	let email=document.querySelector('.email');
	let email2=document.querySelector('.email2');
	
	email.onkeyup=function(){
			var val=email.value.trim();
			if(val){
				//非空
				if(checkReg.email(val)){
					email2.innerHTML='邮箱格式正确';
					email2.style.color='green';
					
				}else{
					email2.innerHTML='邮箱格式不正确';
					email2.style.color='red';
				}
			}
		}
	
	
	//还没有验证用户是否存在到时做完了其他的东西需要在添加这里的功能。
	
	
	

		
	
	//当点击确认的时候向表中插入数据。
	let btninsert =document.querySelector('.btninsert');
	let nicheng=document.querySelector('.nicheng');
	let sex=document.querySelector('.sex');
	let beizhu=document.querySelector('.beizhu')
	let hint=document.querySelector('.hint');
	
	function allvalues(){
		
	}
	btninsert.onclick=()=>{
	//查询数据库中的数据有多少条。	
		let use=username.value.trim();//用户名的值
		let nichen=nicheng.value.trim();//昵称的值
		let pass=password.value.trim();//密码
		let repass=repassword.value.trim();//确认密码
		let phon=phone.value.trim();//手机号
		let xingbie=sex.value.trim();//性别
		let email1=email.value.trim()//邮箱
		let beizhu1=beizhu.value.trim()//备注
		let status = [200,304];
		if(use&&nichen&&pass&&repass&&phon&&xingbie&&email1&&beizhu1){
			//将信息传给后并将数据插入数据库。
			let xhr=new XMLHttpRequest();
			xhr.onload=()=>{
				if(status.includes(xhr.status)){
					 let res = JSON.parse(xhr.responseText);
					  if(res.code==1){
					  	hint.innerHTML='添加用户成功'
						hint.style.color='green';
						username.value="";
						nicheng.value="";
						password.value="";
						repassword.value="";
						phone.value="";
						sex.value="";
						email.value="";
						beizhu.value=""
					  }else{
					  	hint.innerHTML='添加用户失败'
						hint.style.color='red';
					  }
				}
			}
			let data=`use=${use}&nichen=${nichen}&pass=${pass}&repass=${repass}&phon=${phon}&xingbie=${xingbie}&email1=${email1}&beizhu1=${beizhu1}&gid=${2}`
			xhr.open('put','/adduser/adduser1',true);
			xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
			xhr.send(data);
//						console.log(data);
		}else{
			hint.innerHTML='请填入完整的信息';
			hint.style.color='red';
		}
	}
	
	let contain=document.querySelector('.contain');
	function render(arr){
		let html='';
		for(let i=0;i<arr.length;i++){
			html+=`<form>
  <div class="usernicheng">
    <div class="form-group col-md-6">
      <label for="inputEmail4">用户名</label>
      <input type="text" class="form-control username" id="inputEmail4" placeholder="请输入用户名" value="${arr[i].use}">
      <span class="username2"></span>
      
    </div>
    <div class="form-group col-md-6">
      <label for="inputPassword4">昵称</label>
      <input type="text" class="form-control nicheng" id="inputPassword4" placeholder="请输入昵称" value="${arr[i].nichen}">
        <span class="nicheng2"></span>
    </div>
  </div>
  <div class="form-group pass">
    <label for="inputAddress">密码</label>
    <input type="password" class="form-control password" id="inputAddress" placeholder="请输入密码" value="${arr[i].pass}">
     <span class="password2"></span>
  </div>
  <div class="form-group repass">
    <label for="inputAddress2">确认密码</label>
    <input type="password" class="form-control repassword" id="inputAddress2" placeholder="确认密码" value="${arr[i].repass}">
     <span class="repassword2"></span>
  </div>
  <div class="form-row phonesex">
    <div class="form-group col-md-2">
      <label for="inputZip">手机号</label>
      <input type="text" class="form-control phone" id="inputZip" value="${arr[i].phon}">
        <p class="phone2"></p>
    </div>
   <div class="form-group col-md-4">
      <label for="inputState">性别</label>
      <select id="inputState" class="form-control sex" value="">
      	<option selected>${arr[i].xingbie}</option>
        <option >请选择</option>
       <option >男</option>
        <option>女</option>
        <option>其他</option>
      </select>
    </div>
   
  </div>
  <div class="form-group email1">
    <label for="exampleFormControlInput1">邮箱地址</label>
    <input type="email" class="form-control email" id="exampleFormControlInput1" placeholder="请输入邮箱地址" value="${arr[i].email1}">
    <span class="email2"></span>
  </div>
  <div class="form-group beizhu1">
    <label for="exampleFormControlTextarea1">备注</label>
    <textarea class="form-control beizhu" id="exampleFormControlTextarea1" rows="3" >${arr[i].beizhu1}</textarea>
  </div>
  <button type="button" class="btn btn-primary btninsert btnupdate">确认</button>
  <span class="hint"></span>
	<span class="reminder"></span>
  
  
</form>`
		}
		contain.innerHTML=html;
	}
	updataall();
	
	
	
	//获取id进行渲染
	let xhr=new XMLHttpRequest();
	let status = [200,304];
	let  res=(location.search).slice(1)
	let id=res.split('=')[1];
	let data1=`id=${id}`;
	if(data1){
		xhr.onload=function(){
	if(status.includes(xhr.status)){
		 let res = JSON.parse(xhr.responseText);
		let arr=res.data;
		 render(arr);
		}
	}
	
	xhr.open('post','/adduser/slecteone',true);
	xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
	xhr.send(data1);
	
	}
	
	
	
	
	function updataall(){
		//点击更新数据。
	$('.contain').on('click','.btnupdate',function(){
		let use1=$('.username').val();//用户名的值
		let nichen=$('.nicheng').val();//昵称的值
		let pass=$('.password').val();  //密码
		let repass=$('.repassword').val();//确认密码
		let phon=$('.phone').val();//手机号
		let xingbie=$('.sex').val();//性别

		let email1=$('.email').val()//邮箱
		let beizhu1=$('.beizhu').val()//备注
		let data=`use=${use1}&nichen=${nichen}&pass=${pass}&repass=${repass}&phon=${phon}&xingbie=${xingbie}&email1=${email1}&beizhu1=${beizhu1}&idx=${id}`
			let reminder=document.querySelector('.reminder')
	xhr.onload=function(){
		if(status.includes(xhr.status)){
			 let res = JSON.parse(xhr.responseText);
			 console.log(res);
			if(res.code==1){
				
				reminder.innerHTML='更新数据成功';
				reminder.style.color='green';
			}else{
				reminder.innerHTML='更新数据失败';
				reminder.style.color='red';
			}
		}
	}
	xhr.open('post','/adduser/upadata',true);
	xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
	xhr.send(data);
	});
	}
	
	
</script>