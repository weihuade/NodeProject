<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>用户列表</title>
<link rel="stylesheet" href="../css/base.css">
<link rel="stylesheet" href="../assets/bootstrap-4.0.0/dist/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="../css/userslist.css"/>
<script src="../assets/jquery-3.2.1.js"></script>
<script src="../assets/bootstrap-4.0.0/dist/js/bootstrap.js"></script>
<script>
        document.addEventListener("DOMContentLoaded",()=>{
            // 侧边栏菜单
            //多个选择器绑定不同事件
            $(".menu .hover,.table dd span,.table dd li").on({
                mouseenter:function(){
                    $(this).addClass("mouseOver");
                },
                mouseleave:function(){
                    $(this).removeClass("mouseOver");
                }
            });
        })
    </script>
</head>
 
<body>
	 <!-- 左边的侧边栏 -->
    <div class="aside fl">
        <!-- 侧边栏标题 -->
        <div class="title">
            <img src="../assets/images/goodslist/logo.png">
            <span>后台管理系统</span>
        </div>
        <!-- 侧边栏菜单 -->
        <div class="menu">
            <div id="accordion">
                <div class="card">
                    <div class="card-header hover" id="headingOne">
                        <h5 class="mb-0">
                            <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                商品管理
                            </button>
                        </h5>
                    </div>
                
                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">
                            <ul>
                                <li class="hover">商品列表</li>
                                <li class="hover">商品分类</li>
                                <li class="hover">添加商品</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header hover" id="headingTwo">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                用户管理
                            </button>
                        </h5>
                    </div>
                    <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
                    <div class="card-body">
                            <ul>
                                <li class="hover">用户列表</li>
                                <a href="http://localhost:1809/html/adduser.html"><li class="hover">添加用户</li></a>
                            </ul>
                    </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header hover" id="headingThree">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                订单管理
                            </button>
                        </h5>
                    </div>
                    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                        <div class="card-body">
                            <ul>
                                <li class="hover">订单列表</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	
	  <!-- 右边的主体部分 -->
    <div class="main fl">
        <!-- 导航头部 -->
        <div class="m_head">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">首页</a></li>
                    <li class="breadcrumb-item"><a href="#">用户管理</a></li>
                    <li class="breadcrumb-item active" aria-current="page">
                        <a href="#">用户列表</a>
                    </li>
                    
                </ol>
                <a href="#" class="fr">退出</a>
            </nav>
        <img  class="white" src="img/u66.png">
        </div>
        <!-- 主体内容 -->
        <div class="m_body">
            <div class="contain">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mr-auto">
                            <li class="nav-item add">
                                <a class="nav-link adduser" href="./adduser.html">
                                    <i class="icon"><img src="../assets/images/goodslist/add-icon.png"></i><span>添加</span> 
                                </a>
                            </li>
                            <li class="nav-item delete deleteall">
                                    <a class="nav-link" href="#">
                                        <i class="icon"><img src="../assets/images/goodslist/cancel-icon.png"></i><span>删除</span>
                                    </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <dl class="table">
                    <dt>
                        <ul>
                            <li class="check">
                                <input type="checkbox" class="allcheck quanxuan">
                            </li>
                            <li class="gid"><span>ID</span></li>
                            <li class="name">
                                <span>用户名</span>
                            </li>
                            <li class="classify">
                                <span>性别</span>

                            </li>
                            <li class="original">
                                <span>城市</span>

                            </li>
                            <li class="present">
                                <span>签名</span>

                            </li>
                            <li class="stock">
                                <span>职业</span>

                            </li>
                            <li class="status">
                                <span>评分</span>
                            </li>
                            <li class="time">
                                <span>注册时间</span>
                            </li>
                           
                            <li class="handle">
                                <span>操作</span>
                            </li>
                        </ul>
                    </dt>
                  <!--做渲染用的大盒子 render-->
               <div class="render">
                  <!--<dd>
                        <ul>
                            <li class="check dagou">
                                <input type="checkbox" class="allcheck gouxuan">
                            </li>
                            <li class="gid"><span>1</span></li>
                            <li class="name">
                                <span>张三</span>
                            </li>
                            <li class="classify">
                                <span>男</span>

                            </li>
                            <li class="original">
                                <span>P城</span>

                            </li>
                            <li class="present">
                                <span>购物成瘾</span>

                            </li>
                            <li class="stock">
                                <span>老板</span>

                            </li>
                            <li class="status">
                                <span>88888</span>
                            </li>
                            <li class="time">
                                <span>2019-11-11</span>
                            </li>
                            <li class="handle">
                                <span class="edit"><img src="../assets/images/goodslist/pen.png" alt="编辑"></span>
                                <span class="delete"><img src="../assets/images/goodslist/cancel-icon.png" alt="删除"></span>
                                
                           	 	</li>
                        	</ul>
                    	</dd> 
                    	-->
                    	
             
                
                    </div>
                </dl>
            </div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
	//删除当行
	let status = [200,304];
	let xhr= new XMLHttpRequest();
	$('.render').on('click','.delete',function(){
		let re=confirm('是否确认删除')
		if(re){
			xhr.onload=()=>{
			if(status.includes(xhr.status)){
			let res = JSON.parse(xhr.responseText);
			console.log(res)
			
			if(res.code==1){
				alert('删除成功');
				}else{
					alert('删除失败');
				}
			}
			
		}
		
		
		$(this).parent().parent().parent().remove();
		//做用户的接口
		let id=$(this).parents('dd').attr('data-id')
		data=`_id=${id}`;
		xhr.open('delete','/userslist/del',true)
		xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
		xhr.send(data);
		var arr=checked();//判断哪行被选中，存到该数组中
		}
		xuanran();
		
	});
	
	
	



//全选单选
            function check(){
                let $wholecheck = $('.quanxuan'),//全选按钮
                    $soncheck = $('.gouxuan'); //单选按钮

                $wholecheck.click(function(){
                    if($(this).is(':checked')){
                        $soncheck.prop("checked",true);
                    }else{
                        $soncheck.prop("checked",false);
                    }
                });
                
                $soncheck.each(function () {
                    $(this).click(function () {
                        if ($(this).is(':checked')) {
                            //判断：所有单个商品是否勾选
                            var len = $soncheck.length;
                            var num = 0;
                            $soncheck.each(function () {
                                if ($(this).is(':checked')) {
                                    num++;
                                }
                            });
                            if (num == len) {
                                $wholecheck.prop("checked", true);
                            }
                        } else {
                            //单个商品取消勾选，全局全选取消勾选
                            $wholecheck.prop("checked", false);
                        }
                    })
                })
            }
            
            

	
	
	//删除多行
	$('.deleteall').on('click',function(){
		var arr=checked();
		var res=confirm('您确定要删除全部用户吗？');
		if(res){
		//删除arr下标对应的行
		
		for(var i=arr.length-1;i>=0;i--){
			//从后面开始删除
			xhr.onload=function(){
			if(status.includes(xhr.status)){
			 let res = JSON.parse(xhr.responseText);
			 console.log(res);
			 
			}
		}
			xhr.open('delete','/userslist/deleteall',true)
			xhr.send()
			$('.dagou').eq(arr[i]).parent().parent().parent().remove();
			}
		}
		xuanran();
	});
	
	//8.循环判断哪行被选中了
function checked(){
	var arr=[];//设置一个空数组，等会被选中的就把下标存起来
	var le=$('.dagou input').length;
	for(var i=0;i<le;i++){
		if($('.dagou input').eq(i).prop('checked')){
			//不为空证明被选中了
			arr.push(i);
		}
	}
	return arr;
}
	
	
	
	xuanran();
	
   function xuanran(){
   		xhr.onload=()=>{
		if(status.includes(xhr.status)){
			 let res = JSON.parse(xhr.responseText);
				let data=res.data
//				console.log(data)
				let html='';
				for(let i=0;i<data.length;i++){
					html+=`   <dd data-id="${data[i]._id}">
                        <ul>
                            <li class="check dagou">
                                <input type="checkbox" class="allcheck gouxuan">
                            </li>
                            <li class="gid"><span class="id"></span></li>
                            <li class="name">
                                <span>${data[i].use}</span>
                            </li>
                            <li class="classify">
                                <span>${data[i].xingbie}</span>

                            </li>
                            <li class="original">
                                <span>成都</span>

                            </li>
                            <li class="present">
                                <span>${data[i].beizhu1}</span>

                            </li>
                            <li class="stock">
                                <span>老板</span>

                            </li>
                            <li class="status">
                                <span>88888</span>
                            </li>
                            <li class="time">
                                <span>${data[i].add_time.substring(0,10)}</span>
                            </li>
                            <li class="handle">
                                <a href="./adduser.html?id=${data[i]._id}">
                                <span class="edit"><img src="../assets/images/goodslist/pen.png" alt="编辑"></span>
                            	</a>
                                <span class="delete"><img src="../assets/images/goodslist/cancel-icon.png" alt="删除"></span>
                                
                           	 	</li>
                        	</ul>
                    	</dd> 
                    	`;
				}
				$('.render').html(html);
				
				//排序
                let number = $('.render dd li.gid span');
                for(let i=0;i<number.length;i++){
                    number[i].innerHTML = i+1;
                }
                check();
		}
		
	}
	xhr.open('get','/userslist/select',true)
	xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
	xhr.send()
	
   }
	
	
</script>